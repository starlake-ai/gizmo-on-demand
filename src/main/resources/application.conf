gizmosql-proxy {
  # Proxy server configuration
  proxy {
    host = "0.0.0.0"
    host = ${?PROXY_HOST}

    port = 31338
    port = ${?PROXY_PORT}

    # TLS configuration for proxy server (client â†’ proxy)
    tls {
      enabled = true
      enabled = ${?PROXY_TLS_ENABLED}

      # Path to server certificate chain
      cert-chain = "gizmosql-proxy/certs/server-cert.pem"
      cert-chain = ${?PROXY_TLS_CERT_CHAIN}

      # Path to server private key
      private-key = "gizmosql-proxy/certs/server-key.pem"
      private-key = ${?PROXY_TLS_PRIVATE_KEY}
    }
  }
  
  # Backend GizmoSQL server configuration
  backend {
    host = "localhost"
    host = ${?GIZMO_SERVER_HOST}

    port = 31337
    port = ${?GIZMO_SERVER_PORT}

    # TLS configuration for backend connection
    tls {
      enabled = false
      enabled = ${?GIZMOSQL_TLS_ENABLED}

      # Path to trusted certificates for backend
      trusted-certificates = ""
      trusted-certificates = ${?GIZMOSQL_TLS_CERT}
    }

    # Default credentials for anonymous connections (e.g., JDBC clients that don't send auth headers)
    # If set, these credentials will be used when no Authorization header is provided
    default-username = ""
    default-username = ${?GIZMOSQL_DEFAULT_USERNAME}

    default-password = ""
    default-password = ${?GIZMOSQL_DEFAULT_PASSWORD}
  }
  
  # Statement validation configuration
  validation {
    # Enable/disable statement validation
    enabled = false
    enabled = ${?VALIDATION_ENABLED}
    
    # Validation rules
    rules {
      # Allow all statements by default (set to false to deny by default)
      allow-by-default = false
      allow-by-default = ${?VALIDATION_ALLOW_BY_DEFAULT}
      
      # List of users who bypass validation (e.g., admins)
      bypass-users = ["admin"]
      bypass-users = ${?VALIDATION_BYPASS_USERS}
      
      # Database-specific rules file (optional)
      rules-file = ""
      rules-file = ${?VALIDATION_RULES_FILE}
    }
  }
  
  # Logging configuration
  logging {
    level = "INFO"
    level = ${?LOG_LEVEL}

    # Log all SQL statements
    log-statements = true
    log-statements = ${?LOG_STATEMENTS}

    # Log validation decisions
    log-validation = true
    log-validation = ${?LOG_VALIDATION}
  }

  # Session variables passed from environment
  session {
    gizmosql-username = ""
    gizmosql-username = ${?GIZMOSQL_USERNAME}

    gizmosql-password = ""
    gizmosql-password = ${?GIZMOSQL_PASSWORD}

    sl-project-id = ""
    sl-project-id = ${?SL_DB_ID}

    sl-data-path = ""
    sl-data-path = ${?SL_DATA_PATH}

    pg-username = ""
    pg-username = ${?PG_USERNAME}

    pg-password = ""
    pg-password = ${?PG_PASSWORD}

    pg-port = 5432
    pg-port = ${?PG_PORT}

    pg-host = "host.docker.internal"
    pg-host = ${?PG_HOST}

    # JWT Secret key for token generation
    jwt-secret-key = "a_very_secret_key"
    jwt-secret-key = ${?JWT_SECRET_KEY}
  }

}

gizmo-on-demand {
  host = "0.0.0.0"
  host = ${?SL_GIZMO_ON_DEMAND_HOST}

  port = 10900
  port = ${?SL_GIZMO_ON_DEMAND_PORT}

  min-port = 11900
  min-port = ${?SL_GIZMO_MIN_PORT}

  max-port = 12000
  max-port = ${?SL_GIZMO_MAX_PORT}

  max-processes = 10
  max-processes = ${?SL_GIZMO_MAX_PROCESSES}

  default-gizmo-script = "/opt/gizmosql/scripts/docker-start-sl-gizmosql.sh"
  default-gizmo-script = ${?SL_GIZMO_DEFAULT_SCRIPT}

  proxy-script = "/opt/gizmosql/scripts/docker-start-proxy.sh"
  proxy-script = ${?SL_GIZMO_PROXY_SCRIPT}

  # API Key is optional in config, but required at runtime for logic
  api-key = "a_secret_api_key"
  api-key = ${?SL_GIZMO_API_KEY}

  # Idle timeout in seconds for the gizmo backend server
  # >0: Timeout in seconds, the gizmo backend server is stopped after the timeout period if there are no requests
  # <0: No timeout (default), the gizmo backend server is never stopped
  # =0: The gizmo backend server is stopped immediately after each request is processed
  idle-timeout = -1
  idle-timeout = ${?SL_GIZMO_IDLE_TIMEOUT}
}

